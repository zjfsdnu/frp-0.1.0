# frp

[![Build Status](https://travis-ci.org/fatedier/frp.svg)](https://travis-ci.org/fatedier/frp)

A fast reverse proxy.

## 流程
### 客户端
1. 先登录 登录成功后 开启协程发送心跳包
2. 死循环接受服务端返回 如果是心跳包返回重置超时时间 
3. 其他一概建立本地服务器到frp服务端的绑定(两个协程双向绑定)
4. 同时发送给服务端一条建立连接的消息

### 服务端
1. 服务端先开启一个端口 开一个协程 监听frp客户端
2. 一旦有新的连接 发给阻塞channel
3. 主协程死循环 不断读取此channel 一旦有数据 则新建协程处理此连接
4. 先做登录校验 根据段名进行匹配 (有一个全局map 每个键值对对应一个段名)
    校验通过后 分两种消息 一个是 根据服务端配置文件 建立新的监听
    一个是建立工作连接
    1. 建立新的监听 同时开启两个协程 
    2. 一个协程监听新的用户连接 收到后放入map值的list里 同时发送通知给新连接channel
    3. 一个协程等待frp客户端新连接channel 同时绑定新连接和用户连接
5. 之后新开一个协程处理心跳包
6. 然后死循环等待新连接channel 收到后发送消息给frp客户端